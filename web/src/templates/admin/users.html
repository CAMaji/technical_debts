{% extends "_base.html" %}

{% block content %}
<div class="container my-4">
	<div class="d-flex justify-content-between align-items-center mb-4">
		<h1>User Management</h1>
		<a href="{{ url_for('admin_create_user') }}" class="btn btn-primary">
			<i class="bi bi-plus-circle"></i> Create User
		</a>
	</div>
	
	{% with messages = get_flashed_messages(with_categories=true) %}
		{% if messages %}
			{% for category, message in messages %}
				<div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
					{{ message }}
					<button type="button" class="btn-close" data-bs-dismiss="alert"></button>
				</div>
			{% endfor %}
		{% endif %}
	{% endwith %}
	
	<div class="card shadow">
		<div class="card-body">
			<div class="table-responsive">
				<table class="table table-hover">
					<thead>
						<tr>
							<th>Username</th>
							<th>Email</th>
							<th>Name</th>
							<th>Role</th>
							<th>Status</th>
							<th>Created</th>
							<th>Last Login</th>
							<th>Actions</th>
						</tr>
					</thead>
					<tbody>
						{% for user in users %}
						<tr>
							<td>{{ user.username }}</td>
							<td>{{ user.email }}</td>
							<td>{{ user.first_name or '' }} {{ user.last_name or '' }}</td>
							<td>
								{% if user.is_admin %}
									<span class="badge bg-danger">Admin</span>
								{% else %}
									<span class="badge bg-secondary">Member</span>
								{% endif %}
							</td>
							<td>
								{% if user.is_active %}
									<span class="badge bg-success">Active</span>
								{% else %}
									<span class="badge bg-warning">Inactive</span>
								{% endif %}
							</td>
							<td>{{ user.created_at.strftime('%Y-%m-%d') if user.created_at else '-' }}</td>
							<td>{{ user.last_login.strftime('%Y-%m-%d %H:%M') if user.last_login else 'Never' }}</td>
							<td>
								<div class="btn-group btn-group-sm">
									<a href="{{ url_for('admin_edit_user', user_id=user.id) }}" class="btn btn-outline-primary">
										<i class="bi bi-pencil"></i>
									</a>
									<form method="POST" action="{{ url_for('admin_toggle_user_active', user_id=user.id) }}" class="d-inline">
										<button type="submit" class="btn btn-outline-warning" 
												{% if user.id == current_user.id %}disabled{% endif %}>
											<i class="bi bi-{% if user.is_active %}pause{% else %}play{% endif %}-circle"></i>
										</button>
									</form>
									<form method="POST" action="{{ url_for('admin_delete_user', user_id=user.id) }}" 
										  onsubmit="return confirm('Are you sure you want to delete this user?');" class="d-inline">
										<button type="submit" class="btn btn-outline-danger" 
												{% if user.id == current_user.id %}disabled{% endif %}>
											<i class="bi bi-trash"></i>
										</button>
									</form>
								</div>
							</td>
						</tr>
						{% endfor %}
					</tbody>
				</table>
			</div>
		</div>
	</div>
</div>
{% endblock %}
